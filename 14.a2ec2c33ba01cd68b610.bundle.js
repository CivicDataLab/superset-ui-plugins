(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{1358:function(module,exports,__webpack_require__){!function(exports){"use strict";function ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function bisector(compare){var f;return 1===compare.length&&(f=compare,compare=function(d,x){return ascending(f(d),x)}),{left:function(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){var mid=lo+hi>>>1;compare(a[mid],x)<0?lo=mid+1:hi=mid}return lo},right:function(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){var mid=lo+hi>>>1;compare(a[mid],x)>0?hi=mid:lo=mid+1}return lo}}}var ascendingBisect=bisector(ascending),bisectRight=ascendingBisect.right,bisectLeft=ascendingBisect.left;function length(array){return 0|array.length}function empty(length){return!(length>0)}function arrayify(values){return"object"!=typeof values||"length"in values?values:Array.from(values)}function variance(values,valueof){let delta,count=0,mean=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(mean+=(delta=value-mean)/++count,sum+=delta*(value-mean));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(mean+=(delta=value-mean)/++count,sum+=delta*(value-mean))}if(count>1)return sum/(count-1)}function deviation(values,valueof){const v=variance(values,valueof);return v?Math.sqrt(v):v}function extent(values,valueof){let min,max;if(void 0===valueof)for(let value of values)null!=value&&value>=value&&(void 0===min?min=max=value:(min>value&&(min=value),max<value&&(max=value)));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&value>=value&&(void 0===min?min=max=value:(min>value&&(min=value),max<value&&(max=value)))}return[min,max]}function identity(x){return x}function rollup(values,reduce,...keys){return function regroup(values,i){if(i>=keys.length)return reduce(values);const map=function(values,keyof){const map=new Map;let index=-1;for(const value of values){const key=keyof(value,++index,values),group=map.get(key);group?group.push(value):map.set(key,[value])}return map}(values,keys[i]);return new Map(Array.from(map,([k,v])=>[k,regroup(v,i+1)]))}(values,0)}var array=Array.prototype,slice=array.slice,map=array.map;function constant(x){return function(){return x}}function range(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;for(var i=-1,n=0|Math.max(0,Math.ceil((stop-start)/step)),range=new Array(n);++i<n;)range[i]=start+i*step;return range}var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function tickIncrement(start,stop,count){var step=(stop-start)/Math.max(0,count),power=Math.floor(Math.log(step)/Math.LN10),error=step/Math.pow(10,power);return power>=0?(error>=e10?10:error>=e5?5:error>=e2?2:1)*Math.pow(10,power):-Math.pow(10,-power)/(error>=e10?10:error>=e5?5:error>=e2?2:1)}function tickStep(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;return error>=e10?step1*=10:error>=e5?step1*=5:error>=e2&&(step1*=2),stop<start?-step1:step1}function sturges(values){return Math.ceil(Math.log(values.length)/Math.LN2)+1}function number(x){return null===x?NaN:+x}function quantile(values,p,valueof=number){if(n=values.length){if((p=+p)<=0||n<2)return+valueof(values[0],0,values);if(p>=1)return+valueof(values[n-1],n-1,values);var n,i=(n-1)*p,i0=Math.floor(i),value0=+valueof(values[i0],i0,values),value1=+valueof(values[i0+1],i0+1,values);return value0+(value1-value0)*(i-i0)}}function quickselect(array,k,left=0,right=array.length-1,compare=ascending){for(;right>left;){if(right-left>600){const n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1),newLeft=Math.max(left,Math.floor(k-m*s/n+sd)),newRight=Math.min(right,Math.floor(k+(n-m)*s/n+sd));quickselect(array,k,newLeft,newRight,compare)}const t=array[k];let i=left,j=right;for(swap(array,left,k),compare(array[right],t)>0&&swap(array,left,right);i<j;){for(swap(array,i,j),++i,--j;compare(array[i],t)<0;)++i;for(;compare(array[j],t)>0;)--j}0===compare(array[left],t)?swap(array,left,j):swap(array,++j,right),j<=k&&(left=j+1),k<=j&&(right=j-1)}return array}function swap(array,i,j){const t=array[i];array[i]=array[j],array[j]=t}function min(values,valueof){let min;if(void 0===valueof)for(let value of values)null!=value&&value>=value&&(void 0===min||min>value)&&(min=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&value>=value&&(void 0===min||min>value)&&(min=value)}return min}function transpose(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=min(matrix,length$1),transpose=new Array(m);++i<m;)for(var n,j=-1,row=transpose[i]=new Array(n);++j<n;)row[j]=matrix[j][i];return transpose}function length$1(d){return d.length}exports.bisect=bisectRight,exports.bisectRight=bisectRight,exports.bisectLeft=bisectLeft,exports.ascending=ascending,exports.bisector=bisector,exports.cross=function(...values){const reduce="function"==typeof values[values.length-1]&&function(reduce){return values=>reduce(...values)}(values.pop()),lengths=(values=values.map(arrayify)).map(length),j=values.length-1,index=new Array(j+1).fill(0),product=[];if(j<0||lengths.some(empty))return product;for(;;){product.push(index.map((j,i)=>values[i][j]));let i=j;for(;++index[i]===lengths[i];){if(0===i)return reduce?product.map(reduce):product;index[i--]=0}}},exports.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN},exports.deviation=deviation,exports.extent=extent,exports.group=function(values,...keys){return rollup(values,identity,...keys)},exports.histogram=function(){var value=identity,domain=extent,threshold=sturges;function histogram(data){Array.isArray(data)||(data=Array.from(data));var i,x,n=data.length,values=new Array(n);for(i=0;i<n;++i)values[i]=value(data[i],i,data);var xz=domain(values),x0=xz[0],x1=xz[1],tz=threshold(values,x0,x1);Array.isArray(tz)||(tz=tickStep(x0,x1,tz),tz=range(Math.ceil(x0/tz)*tz,x1,tz));for(var m=tz.length;tz[0]<=x0;)tz.shift(),--m;for(;tz[m-1]>x1;)tz.pop(),--m;var bin,bins=new Array(m+1);for(i=0;i<=m;++i)(bin=bins[i]=[]).x0=i>0?tz[i-1]:x0,bin.x1=i<m?tz[i]:x1;for(i=0;i<n;++i)x=values[i],x0<=x&&x<=x1&&bins[bisectRight(tz,x,0,m)].push(data[i]);return bins}return histogram.value=function(_){return arguments.length?(value="function"==typeof _?_:constant(_),histogram):value},histogram.domain=function(_){return arguments.length?(domain="function"==typeof _?_:constant([_[0],_[1]]),histogram):domain},histogram.thresholds=function(_){return arguments.length?(threshold="function"==typeof _?_:Array.isArray(_)?constant(slice.call(_)):constant(_),histogram):threshold},histogram},exports.thresholdFreedmanDiaconis=function(values,min,max){return values=map.call(values,number).sort(ascending),Math.ceil((max-min)/(2*(quantile(values,.75)-quantile(values,.25))*Math.pow(values.length,-1/3)))},exports.thresholdScott=function(values,min,max){return Math.ceil((max-min)/(3.5*deviation(values)*Math.pow(values.length,-1/3)))},exports.thresholdSturges=sturges,exports.max=function(values,valueof){let max;if(void 0===valueof)for(let value of values)null!=value&&value>=value&&(void 0===max||max<value)&&(max=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&value>=value&&(void 0===max||max<value)&&(max=value)}return max},exports.mean=function(values,valueof){let count=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(++count,sum+=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(++count,sum+=value)}if(count)return sum/count},exports.median=function(values,valueof){if(!(values=Float64Array.from(function*(values,valueof){if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(yield value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(yield value)}}(values,valueof))).length)return;const n=values.length,i=n>>1;return quickselect(values,i-1,0),0==(1&n)&&quickselect(values,i,i),quantile(values,.5)},exports.merge=function(arrays){return Array.from(function*(arrays){for(const array of arrays)yield*array}(arrays))},exports.min=min,exports.pairs=function(values,pairof=function(a,b){return[a,b]}){const pairs=[];let previous,first=!1;for(const value of values)first&&pairs.push(pairof(previous,value)),previous=value,first=!0;return pairs},exports.permute=function(array,indexes){for(var i=indexes.length,permutes=new Array(i);i--;)permutes[i]=array[indexes[i]];return permutes},exports.quantile=quantile,exports.quickselect=quickselect,exports.range=range,exports.rollup=rollup,exports.scan=function(values,compare=ascending){let min,minIndex,index=-1;for(const value of values)++index,(void 0===minIndex?0===compare(value,value):compare(value,min)<0)&&(min=value,minIndex=index);return minIndex},exports.shuffle=function(array,i0=0,i1=array.length){for(var t,i,m=i1-(i0=+i0);m;)i=Math.random()*m--|0,t=array[m+i0],array[m+i0]=array[i+i0],array[i+i0]=t;return array},exports.sum=function(values,valueof){let sum=0;if(void 0===valueof)for(let value of values)(value=+value)&&(sum+=value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&(sum+=value)}return sum},exports.ticks=function(start,stop,count){var reverse,n,ticks,step,i=-1;if(count=+count,(start=+start)==(stop=+stop)&&count>0)return[start];if((reverse=stop<start)&&(n=start,start=stop,stop=n),0===(step=tickIncrement(start,stop,count))||!isFinite(step))return[];if(step>0)for(start=Math.ceil(start/step),stop=Math.floor(stop/step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)*step;else for(start=Math.floor(start*step),stop=Math.ceil(stop*step),ticks=new Array(n=Math.ceil(start-stop+1));++i<n;)ticks[i]=(start-i)/step;return reverse&&ticks.reverse(),ticks},exports.tickIncrement=tickIncrement,exports.tickStep=tickStep,exports.transpose=transpose,exports.variance=variance,exports.zip=function(){return transpose(arguments)},Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},1359:function(module,exports,__webpack_require__){var $export=__webpack_require__(13),toISOString=__webpack_require__(1360);$export($export.P+$export.F*(Date.prototype.toISOString!==toISOString),"Date",{toISOString:toISOString})},1360:function(module,exports,__webpack_require__){"use strict";var fails=__webpack_require__(28),getTime=Date.prototype.getTime,$toISOString=Date.prototype.toISOString,lz=function(num){return num>9?num:"0"+num};module.exports=fails(function(){return"0385-07-25T07:06:39.999Z"!=$toISOString.call(new Date(-5e13-1))})||!fails(function(){$toISOString.call(new Date(NaN))})?function(){if(!isFinite(getTime.call(this)))throw RangeError("Invalid time value");var d=this,y=d.getUTCFullYear(),m=d.getUTCMilliseconds(),s=y<0?"-":y>9999?"+":"";return s+("00000"+Math.abs(y)).slice(s?-6:-4)+"-"+lz(d.getUTCMonth()+1)+"-"+lz(d.getUTCDate())+"T"+lz(d.getUTCHours())+":"+lz(d.getUTCMinutes())+":"+lz(d.getUTCSeconds())+"."+(m>99?m:"0"+lz(m))+"Z"}:$toISOString},1361:function(module,exports,__webpack_require__){"use strict";var anObject=__webpack_require__(33),toObject=__webpack_require__(55),toLength=__webpack_require__(65),toInteger=__webpack_require__(124),advanceStringIndex=__webpack_require__(342),regExpExec=__webpack_require__(183),max=Math.max,min=Math.min,floor=Math.floor,SUBSTITUTION_SYMBOLS=/\$([$&`']|\d\d?|<[^>]*>)/g,SUBSTITUTION_SYMBOLS_NO_NAMED=/\$([$&`']|\d\d?)/g;__webpack_require__(184)("replace",2,function(defined,REPLACE,$replace,maybeCallNative){return[function(searchValue,replaceValue){var O=defined(this),fn=null==searchValue?void 0:searchValue[REPLACE];return void 0!==fn?fn.call(searchValue,O,replaceValue):$replace.call(String(O),searchValue,replaceValue)},function(regexp,replaceValue){var res=maybeCallNative($replace,regexp,this,replaceValue);if(res.done)return res.value;var rx=anObject(regexp),S=String(this),functionalReplace="function"==typeof replaceValue;functionalReplace||(replaceValue=String(replaceValue));var global=rx.global;if(global){var fullUnicode=rx.unicode;rx.lastIndex=0}for(var results=[];;){var result=regExpExec(rx,S);if(null===result)break;if(results.push(result),!global)break;""===String(result[0])&&(rx.lastIndex=advanceStringIndex(S,toLength(rx.lastIndex),fullUnicode))}for(var it,accumulatedResult="",nextSourcePosition=0,i=0;i<results.length;i++){result=results[i];for(var matched=String(result[0]),position=max(min(toInteger(result.index),S.length),0),captures=[],j=1;j<result.length;j++)captures.push(void 0===(it=result[j])?it:String(it));var namedCaptures=result.groups;if(functionalReplace){var replacerArgs=[matched].concat(captures,position,S);void 0!==namedCaptures&&replacerArgs.push(namedCaptures);var replacement=String(replaceValue.apply(void 0,replacerArgs))}else replacement=getSubstitution(matched,S,position,captures,namedCaptures,replaceValue);position>=nextSourcePosition&&(accumulatedResult+=S.slice(nextSourcePosition,position)+replacement,nextSourcePosition=position+matched.length)}return accumulatedResult+S.slice(nextSourcePosition)}];function getSubstitution(matched,str,position,captures,namedCaptures,replacement){var tailPos=position+matched.length,m=captures.length,symbols=SUBSTITUTION_SYMBOLS_NO_NAMED;return void 0!==namedCaptures&&(namedCaptures=toObject(namedCaptures),symbols=SUBSTITUTION_SYMBOLS),$replace.call(replacement,symbols,function(match,ch){var capture;switch(ch.charAt(0)){case"$":return"$";case"&":return matched;case"`":return str.slice(0,position);case"'":return str.slice(tailPos);case"<":capture=namedCaptures[ch.slice(1,-1)];break;default:var n=+ch;if(0===n)return match;if(n>m){var f=floor(n/10);return 0===f?match:f<=m?void 0===captures[f-1]?ch.charAt(1):captures[f-1]+ch.charAt(1):match}capture=captures[n-1]}return void 0===capture?"":capture})}})},1362:function(module,exports,__webpack_require__){var global=__webpack_require__(21),inheritIfRequired=__webpack_require__(182),dP=__webpack_require__(32).f,gOPN=__webpack_require__(125).f,isRegExp=__webpack_require__(341),$flags=__webpack_require__(126),$RegExp=global.RegExp,Base=$RegExp,proto=$RegExp.prototype,re1=/a/g,re2=/a/g,CORRECT_NEW=new $RegExp(re1)!==re1;if(__webpack_require__(31)&&(!CORRECT_NEW||__webpack_require__(28)(function(){return re2[__webpack_require__(18)("match")]=!1,$RegExp(re1)!=re1||$RegExp(re2)==re2||"/a/i"!=$RegExp(re1,"i")}))){$RegExp=function(p,f){var tiRE=this instanceof $RegExp,piRE=isRegExp(p),fiU=void 0===f;return!tiRE&&piRE&&p.constructor===$RegExp&&fiU?p:inheritIfRequired(CORRECT_NEW?new Base(piRE&&!fiU?p.source:p,f):Base((piRE=p instanceof $RegExp)?p.source:p,piRE&&fiU?$flags.call(p):f),tiRE?this:proto,$RegExp)};for(var proxy=function(key){key in $RegExp||dP($RegExp,key,{configurable:!0,get:function(){return Base[key]},set:function(it){Base[key]=it}})},keys=gOPN(Base),i=0;keys.length>i;)proxy(keys[i++]);proto.constructor=$RegExp,$RegExp.prototype=proto,__webpack_require__(35)(global,"RegExp",$RegExp)}__webpack_require__(181)("RegExp")},1363:function(module,exports,__webpack_require__){"use strict";__webpack_require__(339)("trim",function($trim){return function(){return $trim(this,3)}})},1364:function(module,exports,__webpack_require__){var $export=__webpack_require__(13);$export($export.P,"Array",{fill:__webpack_require__(1365)}),__webpack_require__(337)("fill")},1365:function(module,exports,__webpack_require__){"use strict";var toObject=__webpack_require__(55),toAbsoluteIndex=__webpack_require__(336),toLength=__webpack_require__(65);module.exports=function(value){for(var O=toObject(this),length=toLength(O.length),aLen=arguments.length,index=toAbsoluteIndex(aLen>1?arguments[1]:void 0,length),end=aLen>2?arguments[2]:void 0,endPos=void 0===end?length:toAbsoluteIndex(end,length);endPos>index;)O[index++]=value;return O}},2104:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var lib=__webpack_require__(1),prop_types=(__webpack_require__(66),__webpack_require__(30),__webpack_require__(34),__webpack_require__(3),__webpack_require__(29),__webpack_require__(2)),prop_types_default=__webpack_require__.n(prop_types),d3_array=__webpack_require__(1358),d3_selection=__webpack_require__(335),color_lib=__webpack_require__(95),number_format_lib=__webpack_require__(176),time_format_lib=__webpack_require__(177),dist=(__webpack_require__(5),__webpack_require__(4),__webpack_require__(1359),__webpack_require__(338),__webpack_require__(1361),__webpack_require__(1362),__webpack_require__(1363),__webpack_require__(340),__webpack_require__(42),__webpack_require__(6),__webpack_require__(180),__webpack_require__(1364),__webpack_require__(334)),dist_default=__webpack_require__.n(dist);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}var d3=__webpack_require__(333),CalHeatMap=(d3=__webpack_require__(333),function(){function w(d,outer){var width=self.options.cellSize*self._domainType[self.options.subDomain].column(d)+self.options.cellPadding*self._domainType[self.options.subDomain].column(d);return 2===arguments.length&&!0===outer?width+=self.domainHorizontalLabelWidth+self.options.domainGutter+self.options.domainMargin[1]+self.options.domainMargin[3]:width}function h(d,outer){var height=self.options.cellSize*self._domainType[self.options.subDomain].row(d)+self.options.cellPadding*self._domainType[self.options.subDomain].row(d);return 2===arguments.length&&!0===outer&&(height+=self.options.domainGutter+self.domainVerticalLabelHeight+self.options.domainMargin[0]+self.options.domainMargin[2]),height}var self=this;for(var type in self.tip=dist_default()().attr("class","d3-tip").direction("n").offset([-5,0]).html(function(d){return"\n      ".concat(self.options.timeFormatter(d.t),": <strong>").concat(self.options.valueFormatter(d.v),"</strong>\n    ")}),self.legendTip=dist_default()().attr("class","d3-tip").direction("n").offset([-5,0]).html(function(d){return self.options.valueFormatter(d)}),this.allowedDataType=["json","csv","tsv","txt"],this.options={itemSelector:"#cal-heatmap",paintOnLoad:!0,range:12,cellSize:10,cellPadding:2,cellRadius:0,domainGutter:2,domainMargin:[0,0,0,0],valueFormatter:function(d){return d},timeFormatter:function(d){return d},domain:"hour",subDomain:"min",colLimit:null,rowLimit:null,weekStartOnMonday:!0,start:new Date,minDate:null,maxDate:null,data:"",dataType:this.allowedDataType[0],dataPostPayload:null,dataRequestHeaders:null,considerMissingDataAsZero:!1,loadOnInit:!0,verticalOrientation:!1,domainDynamicDimension:!0,label:{position:"bottom",align:"center",offset:{x:0,y:0},rotate:null,width:100,height:null},legend:[10,20,30,40],displayLegend:!0,legendCellSize:10,legendCellPadding:2,legendMargin:[0,0,0,0],legendVerticalPosition:"bottom",legendHorizontalPosition:"left",legendOrientation:"horizontal",legendColors:null,highlight:[],itemName:["item","items"],domainLabelFormat:null,subDomainTitleFormat:{empty:"{date}",filled:"{count} {name} {connector} {date}"},subDomainDateFormat:null,subDomainTextFormat:null,legendTitleFormat:{lower:"less than {min} {name}",inner:"between {down} and {up} {name}",upper:"more than {max} {name}"},animationDuration:500,nextSelector:!1,previousSelector:!1,itemNamespace:"cal-heatmap",tooltip:!1,onClick:null,afterLoad:null,afterLoadNextDomain:null,afterLoadPreviousDomain:null,onComplete:null,afterLoadData:function(data){return data},afterUpdate:null,onMaxDomainReached:null,onMinDomainReached:null},this._domainType={min:{name:"minute",level:10,maxItemNumber:60,defaultRowNumber:10,defaultColumnNumber:6,row:function(d){return self.getSubDomainRowNumber(d)},column:function(d){return self.getSubDomainColumnNumber(d)},position:{x:function(d){return Math.floor(d.getMinutes()/self._domainType.min.row(d))},y:function(d){return d.getMinutes()%self._domainType.min.row(d)}},format:{date:"%H:%M, %A %B %-e, %Y",legend:"",connector:"at"},extractUnit:function(d){return new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours(),d.getMinutes()).getTime()}},hour:{name:"hour",level:20,maxItemNumber:function(d){switch(self.options.domain){case"day":return 24;case"week":return 168;case"month":return 24*(self.options.domainDynamicDimension?self.getDayCountInMonth(d):31)}},defaultRowNumber:6,defaultColumnNumber:function(d){switch(self.options.domain){case"day":return 4;case"week":return 28;case"month":return self.options.domainDynamicDimension?self.getDayCountInMonth(d):31}},row:function(d){return self.getSubDomainRowNumber(d)},column:function(d){return self.getSubDomainColumnNumber(d)},position:{x:function(d){return"month"===self.options.domain?0<self.options.colLimit||0<self.options.rowLimit?Math.floor((d.getHours()+24*(d.getDate()-1))/self._domainType.hour.row(d)):Math.floor(d.getHours()/self._domainType.hour.row(d))+4*(d.getDate()-1):"week"===self.options.domain?0<self.options.colLimit||0<self.options.rowLimit?Math.floor((d.getHours()+24*self.getWeekDay(d))/self._domainType.hour.row(d)):Math.floor(d.getHours()/self._domainType.hour.row(d))+4*self.getWeekDay(d):Math.floor(d.getHours()/self._domainType.hour.row(d))},y:function(d){var p=d.getHours();if(0<self.options.colLimit||0<self.options.rowLimit)switch(self.options.domain){case"month":p+=24*(d.getDate()-1);break;case"week":p+=24*self.getWeekDay(d)}return Math.floor(p%self._domainType.hour.row(d))}},format:{date:"%Hh, %A %B %-e, %Y",legend:"%H:00",connector:"at"},extractUnit:function(d){return new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours()).getTime()}},day:{name:"day",level:30,maxItemNumber:function(d){switch(self.options.domain){case"week":return 7;case"month":return self.options.domainDynamicDimension?self.getDayCountInMonth(d):31;case"year":return self.options.domainDynamicDimension?self.getDayCountInYear(d):366}},defaultColumnNumber:function(d){switch(d=new Date(d),self.options.domain){case"week":return 1;case"month":return self.options.domainDynamicDimension&&!self.options.verticalOrientation?self.getWeekNumber(new Date(d.getFullYear(),d.getMonth()+1,0))-self.getWeekNumber(d)+1:6;case"year":return self.options.domainDynamicDimension?self.getWeekNumber(new Date(d.getFullYear(),11,31))-self.getWeekNumber(new Date(d.getFullYear(),0))+1:54}},defaultRowNumber:7,row:function(d){return self.getSubDomainRowNumber(d)},column:function(d){return self.getSubDomainColumnNumber(d)},position:{x:function(d){switch(self.options.domain){case"week":return Math.floor(self.getWeekDay(d)/self._domainType.day.row(d));case"month":return 0<self.options.colLimit||0<self.options.rowLimit?Math.floor((d.getDate()-1)/self._domainType.day.row(d)):self.getWeekNumber(d)-self.getWeekNumber(new Date(d.getFullYear(),d.getMonth()));case"year":return 0<self.options.colLimit||0<self.options.rowLimit?Math.floor((self.getDayOfYear(d)-1)/self._domainType.day.row(d)):self.getWeekNumber(d)}},y:function(d){var p=self.getWeekDay(d);if(0<self.options.colLimit||0<self.options.rowLimit)switch(self.options.domain){case"year":p=self.getDayOfYear(d)-1;break;case"week":p=self.getWeekDay(d);break;case"month":p=d.getDate()-1}return Math.floor(p%self._domainType.day.row(d))}},format:{date:"%A %B %-e, %Y",legend:"%e %b",connector:"on"},extractUnit:function(d){return new Date(d.getFullYear(),d.getMonth(),d.getDate()).getTime()}},week:{name:"week",level:40,maxItemNumber:54,defaultColumnNumber:function(d){switch(d=new Date(d),self.options.domain){case"year":return self._domainType.week.maxItemNumber;case"month":return self.options.domainDynamicDimension?self.getWeekNumber(new Date(d.getFullYear(),d.getMonth()+1,0))-self.getWeekNumber(d):5}},defaultRowNumber:1,row:function(d){return self.getSubDomainRowNumber(d)},column:function(d){return self.getSubDomainColumnNumber(d)},position:{x:function(d){switch(self.options.domain){case"year":return Math.floor(self.getWeekNumber(d)/self._domainType.week.row(d));case"month":return Math.floor(self.getMonthWeekNumber(d)/self._domainType.week.row(d))}},y:function(d){return self.getWeekNumber(d)%self._domainType.week.row(d)}},format:{date:"%B Week #%W",legend:"%B Week #%W",connector:"in"},extractUnit:function(d){var dt=new Date(d.getFullYear(),d.getMonth(),d.getDate()),weekDay=dt.getDay()-(self.options.weekStartOnMonday?1:0);return 0>weekDay&&(weekDay=6),dt.setDate(dt.getDate()-weekDay),dt.getTime()}},month:{name:"month",level:50,maxItemNumber:12,defaultColumnNumber:12,defaultRowNumber:1,row:function(){return self.getSubDomainRowNumber()},column:function(){return self.getSubDomainColumnNumber()},position:{x:function(d){return Math.floor(d.getMonth()/self._domainType.month.row(d))},y:function(d){return d.getMonth()%self._domainType.month.row(d)}},format:{date:"%B %Y",legend:"%B",connector:"in"},extractUnit:function(d){return new Date(d.getFullYear(),d.getMonth()).getTime()}},year:{name:"year",level:60,row:function(){return self.options.rowLimit||1},column:function(){return self.options.colLimit||1},position:{x:function(){return 1},y:function(){return 1}},format:{date:"%Y",legend:"%Y",connector:"in"},extractUnit:function(d){return new Date(d.getFullYear()).getTime()}}},this._domainType)if(this._domainType.hasOwnProperty(type)){var d=this._domainType[type];this._domainType["x_"+type]={name:"x_"+type,level:d.type,maxItemNumber:d.maxItemNumber,defaultRowNumber:d.defaultRowNumber,defaultColumnNumber:d.defaultColumnNumber,row:d.column,column:d.row,position:{x:d.position.y,y:d.position.x},format:d.format,extractUnit:d.extractUnit}}this.lastInsertedSvg=null,this._completed=!1,this._domains=d3.map(),this.graphDim={width:0,height:0},this.legendDim={width:0,height:0},this.NAVIGATE_LEFT=1,this.NAVIGATE_RIGHT=2,this.RESET_ALL_ON_UPDATE=0,this.RESET_SINGLE_ON_UPDATE=1,this.APPEND_ON_UPDATE=2,this.DEFAULT_LEGEND_MARGIN=10,this.root=null,this.tooltip=null,this._maxDomainReached=!1,this._minDomainReached=!1,this.domainPosition=new DomainPosition,this.Legend=null,this.legendScale=null,this.DSTDomain=[],this._init=function(){return self.getDomain(self.options.start).map(function(d){return d.getTime()}).map(function(d){self._domains.set(d,self.getSubDomain(d).map(function(d){return{t:self._domainType[self.options.subDomain].extractUnit(d),v:null}}))}),self.root=d3.select(self.options.itemSelector).append("svg").attr("class","cal-heatmap-container"),self.root.attr("x",0).attr("y",0).append("svg").attr("class","graph"),self.Legend=new Legend(self),self.options.paintOnLoad&&function(){self.verticalDomainLabel="top"===self.options.label.position||"bottom"===self.options.label.position,self.domainVerticalLabelHeight=null===self.options.label.height?Math.max(25,2*self.options.cellSize):self.options.label.height,self.domainHorizontalLabelWidth=0,""===self.options.domainLabelFormat&&null===self.options.label.height&&(self.domainVerticalLabelHeight=0),self.verticalDomainLabel||(self.domainVerticalLabelHeight=0,self.domainHorizontalLabelWidth=self.options.label.width),self.paint(),!1!==self.options.nextSelector&&d3.select(self.options.nextSelector).on("click."+self.options.itemNamespace,function(){return d3.event.preventDefault(),self.loadNextDomain(1)}),!1!==self.options.previousSelector&&d3.select(self.options.previousSelector).on("click."+self.options.itemNamespace,function(){return d3.event.preventDefault(),self.loadPreviousDomain(1)}),self.Legend.redraw(self.graphDim.width-self.options.domainGutter-self.options.cellPadding),self.afterLoad();var domains=self.getDomainKeys();self.options.loadOnInit?self.getDatas(self.options.data,new Date(domains[0]),self.getSubDomain(domains[domains.length-1]).pop(),function(){self.fill(),self.onComplete()}):self.onComplete(),self.checkIfMinDomainIsReached(domains[0]),self.checkIfMaxDomainIsReached(self.getNextDomain().getTime())}(),self.root.call(self.tip),self.root.call(self.legendTip),!0},this.paint=function(navigationDir){function getDomainPosition(domainIndex,graphDim,axis,domainDim){var tmp=0;return!1===navigationDir?(tmp=graphDim[axis],graphDim[axis]+=domainDim,self.domainPosition.setPosition(domainIndex,tmp),tmp):navigationDir===self.NAVIGATE_RIGHT?(self.domainPosition.setPosition(domainIndex,graphDim[axis]),enteringDomainDim=domainDim,exitingDomainDim=self.domainPosition.getPositionFromIndex(1),self.domainPosition.shiftRightBy(exitingDomainDim),graphDim[axis]):navigationDir===self.NAVIGATE_LEFT?(enteringDomainDim=-(tmp=-domainDim),exitingDomainDim=graphDim[axis]-self.domainPosition.getLast(),self.domainPosition.setPosition(domainIndex,tmp),self.domainPosition.shiftLeftBy(enteringDomainDim),tmp):void 0}var options=self.options;0===arguments.length&&(navigationDir=!1);var domainSvg=self.root.select(".graph").selectAll(".graph-domain").data(function(){var data=self.getDomainKeys();return navigationDir===self.NAVIGATE_LEFT?data.reverse():data},function(d){return d}),enteringDomainDim=0,exitingDomainDim=0,svg=domainSvg.enter().append("svg").attr("width",function(d){return w(d,!0)}).attr("height",function(d){return h(d,!0)}).attr("x",function(d){return options.verticalOrientation?(self.graphDim.width=Math.max(self.graphDim.width,w(d,!0)),0):getDomainPosition(d,self.graphDim,"width",w(d,!0))}).attr("y",function(d){return options.verticalOrientation?getDomainPosition(d,self.graphDim,"height",h(d,!0)):(self.graphDim.height=Math.max(self.graphDim.height,h(d,!0)),0)}).attr("class",function(d){var classname="graph-domain",date=new Date(d);switch(options.domain){case"hour":classname+=" h_"+date.getHours();case"day":classname+=" d_"+date.getDate()+" dy_"+date.getDay();case"week":classname+=" w_"+self.getWeekNumber(date);case"month":classname+=" m_"+(date.getMonth()+1);case"year":classname+=" y_"+date.getFullYear()}return classname});self.lastInsertedSvg=svg,svg.append("rect").attr("width",function(d){return w(d,!0)-options.domainGutter-options.cellPadding}).attr("height",function(d){return h(d,!0)-options.domainGutter-options.cellPadding}).attr("class","domain-background");var rect=svg.append("svg").attr("x",function(){return"left"===options.label.position?self.domainHorizontalLabelWidth+options.domainMargin[3]:options.domainMargin[3]}).attr("y",function(){return"top"===options.label.position?self.domainVerticalLabelHeight+options.domainMargin[0]:options.domainMargin[0]}).attr("class","graph-subdomain-group").selectAll("g").data(function(d){return self._domains.get(d)}).enter().append("g");rect.append("rect").attr("class",function(d){return"graph-rect"+self.getHighlightClassName(d.t)+(null===options.onClick?"":" hover_cursor")}).attr("width",options.cellSize).attr("height",options.cellSize).attr("x",function(d){return self.positionSubDomainX(d.t)}).attr("y",function(d){return self.positionSubDomainY(d.t)}).on("click",function(d){if(null!==options.onClick)return self.onClick(new Date(d.t),d.v)}).call(function(selection){0<options.cellRadius&&selection.attr("rx",options.cellRadius).attr("ry",options.cellRadius),null!==self.legendScale&&null!==options.legendColors&&options.legendColors.hasOwnProperty("base")&&selection.attr("fill",options.legendColors.base),options.tooltip&&selection.on("mouseover",function(d){self.tip.show(d,this)}).on("mouseout",function(){self.tip.hide(d)})}),options.tooltip||rect.append("title").text(function(d){return self.formatDate(new Date(d.t),options.subDomainDateFormat)}),""!==options.domainLabelFormat&&svg.append("text").attr("class","graph-label").attr("y",function(d){var y=options.domainMargin[0];switch(options.label.position){case"top":y+=self.domainVerticalLabelHeight/2;break;case"bottom":y+=h(d)+self.domainVerticalLabelHeight/2}return y+options.label.offset.y*("right"===options.label.rotate&&"right"===options.label.position||"left"===options.label.rotate&&"left"===options.label.position?-1:1)}).attr("x",function(d){var x=options.domainMargin[3];switch(options.label.position){case"right":x+=w(d);break;case"bottom":case"top":x+=w(d)/2}return"right"===options.label.align?x+self.domainHorizontalLabelWidth-options.label.offset.x*("right"===options.label.rotate?-1:1):x+options.label.offset.x}).attr("text-anchor",function(){switch(options.label.align){case"start":case"left":return"start";case"end":case"right":return"end";default:return"middle"}}).attr("dominant-baseline",function(){return self.verticalDomainLabel?"middle":"top"}).text(function(d){return self.formatDate(new Date(d),options.domainLabelFormat)}).call(function(selection){switch(options.label.rotate){case"right":selection.attr("transform",function(d){var s="rotate(90), ";switch(options.label.position){case"right":s+="translate(-"+w(d)+" , -"+w(d)+")";break;case"left":s+="translate(0, -"+self.domainHorizontalLabelWidth+")"}return s});break;case"left":selection.attr("transform",function(d){var s="rotate(270), ";switch(options.label.position){case"right":s+="translate(-"+(w(d)+self.domainHorizontalLabelWidth)+" , "+w(d)+")";break;case"left":s+="translate(-"+self.domainHorizontalLabelWidth+" , "+self.domainHorizontalLabelWidth+")"}return s})}}),null!==options.subDomainTextFormat&&rect.append("text").attr("class",function(d){return"subdomain-text"+self.getHighlightClassName(d.t)}).attr("x",function(d){return self.positionSubDomainX(d.t)+options.cellSize/2}).attr("y",function(d){return self.positionSubDomainY(d.t)+options.cellSize/2}).attr("text-anchor","middle").attr("dominant-baseline","central").text(function(d){return self.formatDate(new Date(d.t),options.subDomainTextFormat)}),!1!==navigationDir&&domainSvg.transition().duration(options.animationDuration).attr("x",function(d){return options.verticalOrientation?0:self.domainPosition.getPosition(d)}).attr("y",function(d){return options.verticalOrientation?self.domainPosition.getPosition(d):0});var tempWidth=self.graphDim.width,tempHeight=self.graphDim.height;options.verticalOrientation?self.graphDim.height+=enteringDomainDim-exitingDomainDim:self.graphDim.width+=enteringDomainDim-exitingDomainDim,domainSvg.exit().transition().duration(options.animationDuration).attr("x",function(d){return options.verticalOrientation?0:navigationDir===self.NAVIGATE_LEFT?Math.min(self.graphDim.width,tempWidth):navigationDir===self.NAVIGATE_RIGHT?-w(d,!0):void 0}).attr("y",function(d){if(!options.verticalOrientation)return 0;switch(navigationDir){case self.NAVIGATE_LEFT:return Math.min(self.graphDim.height,tempHeight);case self.NAVIGATE_RIGHT:return-h(d,!0)}}).remove(),self.resize()}});CalHeatMap.prototype={init:function(settings){function validateSelector(selector,canBeFalse,name){if((canBeFalse&&!1===selector||selector instanceof Element||"string"==typeof selector)&&""!==selector)return!0;throw new Error("The "+name+" is not valid")}function expandMarginSetting(value){switch("number"==typeof value&&(value=[value]),Array.isArray(value)||(console.log("Margin only takes an integer or an array of integers"),value=[0]),value.length){case 1:return[value[0],value[0],value[0],value[0]];case 2:return[value[0],value[1],value[0],value[1]];case 3:return[value[0],value[1],value[2],value[1]];case 4:return value;default:return value.slice(0,4)}}var domain,parent=this,options=parent.options=function mergeRecursive(obj1,obj2){for(var p in obj2)try{obj1[p]=obj2[p].constructor===Object?mergeRecursive(obj1[p],obj2[p]):obj2[p]}catch(e){obj1[p]=obj2[p]}return obj1}(parent.options,settings);if(function(){if(!parent._domainType.hasOwnProperty(options.domain)||"min"===options.domain||"x_"===options.domain.substring(0,2))throw new Error("The domain '"+options.domain+"' is not valid");if(!parent._domainType.hasOwnProperty(options.subDomain)||"year"===options.subDomain)throw new Error("The subDomain '"+options.subDomain+"' is not valid");if(parent._domainType[options.domain].level<=parent._domainType[options.subDomain].level)throw new Error("'"+options.subDomain+"' is not a valid subDomain to '"+options.domain+"'")}(),validateSelector(options.itemSelector,!1,"itemSelector"),-1===parent.allowedDataType.indexOf(options.dataType))throw new Error("The data type '"+options.dataType+"' is not valid data type");if(null===d3.select(options.itemSelector)[0][0])throw new Error("The node '"+options.itemSelector+"' specified in itemSelector does not exists");try{validateSelector(options.nextSelector,!0,"nextSelector"),validateSelector(options.previousSelector,!0,"previousSelector")}catch(error){return console.log(error.message),!1}settings.hasOwnProperty("subDomain")||(this.options.subDomain="year"===(domain=settings.domain)?"month":"month"===domain?"day":"week"===domain?"day":"day"===domain?"hour":"min"),("string"!=typeof options.itemNamespace||""===options.itemNamespace)&&(console.log("itemNamespace can not be empty, falling back to cal-heatmap"),options.itemNamespace="cal-heatmap");var value,s=["data","onComplete","onClick","afterLoad","afterLoadData","afterLoadPreviousDomain","afterLoadNextDomain","afterUpdate"];for(var k in s)settings.hasOwnProperty(s[k])&&(options[s[k]]=settings[s[k]]);return options.subDomainDateFormat="string"==typeof options.subDomainDateFormat||"function"==typeof options.subDomainDateFormat?options.subDomainDateFormat:this._domainType[options.subDomain].format.date,options.domainLabelFormat="string"==typeof options.domainLabelFormat||"function"==typeof options.domainLabelFormat?options.domainLabelFormat:this._domainType[options.domain].format.legend,options.subDomainTextFormat="string"==typeof options.subDomainTextFormat&&""!==options.subDomainTextFormat||"function"==typeof options.subDomainTextFormat?options.subDomainTextFormat:null,options.domainMargin=expandMarginSetting(options.domainMargin),options.legendMargin=expandMarginSetting(options.legendMargin),options.highlight=parent.expandDateSetting(options.highlight),options.itemName="string"==typeof(value=options.itemName)?[value,value+(""===value?"":"s")]:Array.isArray(value)?1===value.length?[value[0],value[0]+"s"]:2<value.length?value.slice(0,2):value:["item","items"],options.colLimit=function(value){return 0<value?value:null}(options.colLimit),options.rowLimit=function(value){return 0<value&&0<options.colLimit?(console.log("colLimit and rowLimit are mutually exclusive, rowLimit will be ignored"),null):0<value?value:null}(options.rowLimit),settings.hasOwnProperty("legendMargin")||function(){switch(options.legendVerticalPosition){case"top":options.legendMargin[2]=parent.DEFAULT_LEGEND_MARGIN;break;case"bottom":options.legendMargin[0]=parent.DEFAULT_LEGEND_MARGIN;break;case"middle":case"center":options.legendMargin["right"===options.legendHorizontalPosition?3:1]=parent.DEFAULT_LEGEND_MARGIN}}(),function(){if(!settings.hasOwnProperty("label")||settings.hasOwnProperty("label")&&!settings.label.hasOwnProperty("align")){switch(options.label.position){case"left":options.label.align="right";break;case"right":options.label.align="left";break;default:options.label.align="center"}"left"===options.label.rotate?options.label.align="right":"right"===options.label.rotate&&(options.label.align="left")}settings.hasOwnProperty("label")&&(!settings.hasOwnProperty("label")||settings.label.hasOwnProperty("offset"))||"left"!==options.label.position&&"right"!==options.label.position||(options.label.offset={x:10,y:15})}(),this._init()},expandDateSetting:function(value){return Array.isArray(value)||(value=[value]),value.map(function(data){return"now"===data?new Date:!!(data instanceof Date)&&data}).filter(function(d){return!1!==d})},fill:function(svg){var parent=this,options=parent.options;0===arguments.length&&(svg=parent.root.selectAll(".graph-domain"));var rect=svg.selectAll("svg").selectAll("g").data(function(d){return parent._domains.get(d)});rect.transition().duration(options.animationDuration).select("rect").attr("class",function(d){var htmlClass=parent.getHighlightClassName(d.t).trim().split(" "),pastDate=parent.dateIsLessThan(d.t,new Date),sameDate=parent.dateIsEqual(d.t,new Date);return null!==parent.legendScale&&(null!==d.v||!options.hasOwnProperty("considerMissingDataAsZero")||options.considerMissingDataAsZero||options.legendColors.hasOwnProperty("base"))||htmlClass.push("graph-rect"),sameDate?htmlClass.push("now"):!pastDate&&htmlClass.push("future"),null===d.v?options.considerMissingDataAsZero&&pastDate&&htmlClass.push(parent.Legend.getClass(0,null===parent.legendScale)):htmlClass.push(parent.Legend.getClass(d.v,null===parent.legendScale)),null!==options.onClick&&htmlClass.push("hover_cursor"),htmlClass.join(" ")}).call(function(element){return null!==parent.legendScale&&void element.attr("fill",function(d){return null===d.v&&options.hasOwnProperty("considerMissingDataAsZero")&&!options.considerMissingDataAsZero&&options.legendColors.hasOwnProperty("base")?options.legendColors.base:null!==options.legendColors&&options.legendColors.hasOwnProperty("empty")&&(0===d.v||null===d.v&&options.hasOwnProperty("considerMissingDataAsZero")&&options.considerMissingDataAsZero)?options.legendColors.empty:0>d.v&&0<options.legend[0]&&null!==options.legendColors&&options.legendColors.hasOwnProperty("overflow")?options.legendColors.overflow:parent.legendScale(Math.min(d.v,options.legend[options.legend.length-1]))})}),rect.transition().duration(options.animationDuration).select("title").text(function(d){return parent.getSubDomainTitle(d)}),rect.transition().duration(options.animationDuration).select("text").attr("class",function(d){return"subdomain-text"+parent.getHighlightClassName(d.t)}).call(function(element){"function"==typeof options.subDomainTextFormat&&element.text(function(d){return options.subDomainTextFormat(d.t,d.v)})})},formatStringWithObject:function(formatted,args){for(var prop in args)if(args.hasOwnProperty(prop)){var regexp=new RegExp("\\{"+prop+"\\}","gi");formatted=formatted.replace(regexp,args[prop])}return formatted},triggerEvent:function(eventName,successArgs,skip){return!!(3===arguments.length&&skip||null===this.options[eventName])||("function"==typeof this.options[eventName]?("function"==typeof successArgs&&(successArgs=successArgs()),this.options[eventName].apply(this,successArgs)):(console.log("Provided callback for "+eventName+" is not a function."),!1))},onClick:function(d,itemNb){return this.triggerEvent("onClick",[d,itemNb])},afterLoad:function(){return this.triggerEvent("afterLoad")},onComplete:function(){var response=this.triggerEvent("onComplete",[],this._completed);return this._completed=!0,response},afterLoadPreviousDomain:function(start){var parent=this;return this.triggerEvent("afterLoadPreviousDomain",function(){var subDomain=parent.getSubDomain(start);return[subDomain.shift(),subDomain.pop()]})},afterLoadNextDomain:function(start){var parent=this;return this.triggerEvent("afterLoadNextDomain",function(){var subDomain=parent.getSubDomain(start);return[subDomain.shift(),subDomain.pop()]})},onMinDomainReached:function(reached){return this._minDomainReached=reached,this.triggerEvent("onMinDomainReached",[reached])},onMaxDomainReached:function(reached){return this._maxDomainReached=reached,this.triggerEvent("onMaxDomainReached",[reached])},checkIfMinDomainIsReached:function(date,upperBound){this.minDomainIsReached(date)&&this.onMinDomainReached(!0),2===arguments.length&&this._maxDomainReached&&!this.maxDomainIsReached(upperBound)&&this.onMaxDomainReached(!1)},checkIfMaxDomainIsReached:function(date,lowerBound){this.maxDomainIsReached(date)&&this.onMaxDomainReached(!0),2===arguments.length&&this._minDomainReached&&!this.minDomainIsReached(lowerBound)&&this.onMinDomainReached(!1)},afterUpdate:function(){return this.triggerEvent("afterUpdate")},formatNumber:d3.format(",g"),formatDate:function(d,format){return 2>arguments.length&&(format="title"),"function"==typeof format?format(d):d3.time.format(format)(d)},getSubDomainTitle:function(d){if(null===d.v&&!this.options.considerMissingDataAsZero)return this.formatStringWithObject(this.options.subDomainTitleFormat.empty,{date:this.formatDate(new Date(d.t),this.options.subDomainDateFormat)});var value=d.v;return null===value&&this.options.considerMissingDataAsZero&&(value=0),this.formatStringWithObject(this.options.subDomainTitleFormat.filled,{count:this.formatNumber(value),name:this.options.itemName[1===value?0:1],connector:this._domainType[this.options.subDomain].format.connector,date:this.formatDate(new Date(d.t),this.options.subDomainDateFormat)})},loadNextDomain:function(n){if(this._maxDomainReached||0===n)return!1;var bound=this.loadNewDomains(this.NAVIGATE_RIGHT,this.getDomain(this.getNextDomain(),n));return this.afterLoadNextDomain(bound.end),this.checkIfMaxDomainIsReached(this.getNextDomain().getTime(),bound.start),!0},loadPreviousDomain:function(n){if(this._minDomainReached||0===n)return!1;var bound=this.loadNewDomains(this.NAVIGATE_LEFT,this.getDomain(this.getDomainKeys()[0],-n).reverse());return this.afterLoadPreviousDomain(bound.start),this.checkIfMinDomainIsReached(bound.start,bound.end),!0},loadNewDomains:function(direction,newDomains){function buildSubDomain(d){return{t:parent._domainType[parent.options.subDomain].extractUnit(d),v:null}}for(var parent=this,backward=direction===this.NAVIGATE_LEFT,i=-1,total=newDomains.length,domains=this.getDomainKeys();++i<total;){if(backward&&this.minDomainIsReached(newDomains[i])){newDomains=newDomains.slice(0,i+1);break}if(!backward&&this.maxDomainIsReached(newDomains[i])){newDomains=newDomains.slice(0,i);break}}for(i=0,total=(newDomains=newDomains.slice(-this.options.range)).length;i<total;i++)this._domains.set(newDomains[i].getTime(),this.getSubDomain(newDomains[i]).map(buildSubDomain)),this._domains.remove(backward?domains.pop():domains.shift());return domains=this.getDomainKeys(),backward&&(newDomains=newDomains.reverse()),this.paint(direction),this.getDatas(this.options.data,newDomains[0],this.getSubDomain(newDomains[newDomains.length-1]).pop(),function(){parent.fill(parent.lastInsertedSvg)}),{start:newDomains[backward?0:1],end:domains[domains.length-1]}},maxDomainIsReached:function(datetimestamp){return null!==this.options.maxDate&&this.options.maxDate.getTime()<datetimestamp},minDomainIsReached:function(datetimestamp){return null!==this.options.minDate&&this.options.minDate.getTime()>=datetimestamp},getDomainKeys:function(){return this._domains.keys().map(function(d){return parseInt(d,10)}).sort(function(a,b){return a-b})},positionSubDomainX:function(d){var index=this._domainType[this.options.subDomain].position.x(new Date(d));return index*this.options.cellSize+index*this.options.cellPadding},positionSubDomainY:function(d){var index=this._domainType[this.options.subDomain].position.y(new Date(d));return index*this.options.cellSize+index*this.options.cellPadding},getSubDomainColumnNumber:function(d){if(0<this.options.rowLimit){var i=this._domainType[this.options.subDomain].maxItemNumber;return"function"==typeof i&&(i=i(d)),Math.ceil(i/this.options.rowLimit)}var j=this._domainType[this.options.subDomain].defaultColumnNumber;return"function"==typeof j&&(j=j(d)),this.options.colLimit||j},getSubDomainRowNumber:function(d){if(0<this.options.colLimit){var i=this._domainType[this.options.subDomain].maxItemNumber;return"function"==typeof i&&(i=i(d)),Math.ceil(i/this.options.colLimit)}var j=this._domainType[this.options.subDomain].defaultRowNumber;return"function"==typeof j&&(j=j(d)),this.options.rowLimit||j},getHighlightClassName:function(d){if(d=new Date(d),0<this.options.highlight.length)for(var i in this.options.highlight)if(this.dateIsEqual(this.options.highlight[i],d))return this.isNow(this.options.highlight[i])?" highlight-now":" highlight";return""},isNow:function(d){return this.dateIsEqual(d,new Date)},dateIsEqual:function(dateA,dateB){switch(dateA instanceof Date||(dateA=new Date(dateA)),dateB instanceof Date||(dateB=new Date(dateB)),this.options.subDomain){case"x_min":case"min":return dateA.getFullYear()===dateB.getFullYear()&&dateA.getMonth()===dateB.getMonth()&&dateA.getDate()===dateB.getDate()&&dateA.getHours()===dateB.getHours()&&dateA.getMinutes()===dateB.getMinutes();case"x_hour":case"hour":return dateA.getFullYear()===dateB.getFullYear()&&dateA.getMonth()===dateB.getMonth()&&dateA.getDate()===dateB.getDate()&&dateA.getHours()===dateB.getHours();case"x_day":case"day":return dateA.getFullYear()===dateB.getFullYear()&&dateA.getMonth()===dateB.getMonth()&&dateA.getDate()===dateB.getDate();case"x_week":case"week":return dateA.getFullYear()===dateB.getFullYear()&&this.getWeekNumber(dateA)===this.getWeekNumber(dateB);case"x_month":case"month":return dateA.getFullYear()===dateB.getFullYear()&&dateA.getMonth()===dateB.getMonth();default:return!1}},dateIsLessThan:function(dateA,dateB){function normalizedMillis(date,subdomain){return"x_min"===subdomain||"min"===subdomain?new Date(date.getFullYear(),date.getMonth(),date.getDate(),date.getHours(),date.getMinutes()).getTime():"x_hour"===subdomain||"hour"===subdomain?new Date(date.getFullYear(),date.getMonth(),date.getDate(),date.getHours()).getTime():"x_day"===subdomain||"day"===subdomain?new Date(date.getFullYear(),date.getMonth(),date.getDate()).getTime():"x_week"===subdomain||"week"===subdomain||"x_month"===subdomain||"month"===subdomain?new Date(date.getFullYear(),date.getMonth()).getTime():date.getTime()}return dateA instanceof Date||(dateA=new Date(dateA)),dateB instanceof Date||(dateB=new Date(dateB)),normalizedMillis(dateA,this.options.subDomain)<normalizedMillis(dateB,this.options.subDomain)},getDayOfYear:d3.time.format("%j"),getWeekNumber:function(d){return(!0===this.options.weekStartOnMonday?d3.time.format("%W"):d3.time.format("%U"))(d)},getMonthWeekNumber:function(d){"number"==typeof d&&(d=new Date(d));var monthFirstWeekNumber=this.getWeekNumber(new Date(d.getFullYear(),d.getMonth()));return this.getWeekNumber(d)-monthFirstWeekNumber-1},getWeekNumberInYear:function(d){"number"==typeof d&&(d=new Date(d))},getDayCountInMonth:function(d){return this.getEndOfMonth(d).getDate()},getDayCountInYear:function(d){return"number"==typeof d&&(d=new Date(d)),1===new Date(d.getFullYear(),1,29).getMonth()?366:365},getWeekDay:function(d){return!1===this.options.weekStartOnMonday?d.getDay():0===d.getDay()?6:d.getDay()-1},getEndOfMonth:function(d){return"number"==typeof d&&(d=new Date(d)),new Date(d.getFullYear(),d.getMonth()+1,0)},jumpDate:function(date,count,step){var d=new Date(date);return"hour"===step?d.setHours(d.getHours()+count):"day"===step?d.setHours(d.getHours()+24*count):"week"===step?d.setHours(d.getHours()+24*count*7):"month"===step?d.setMonth(d.getMonth()+count):"year"===step&&d.setFullYear(d.getFullYear()+count),new Date(d)},getMinuteDomain:function(d,range){var stop,start=new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours());return stop=range instanceof Date?new Date(range.getFullYear(),range.getMonth(),range.getDate(),range.getHours()):new Date(+start+1e3*range*60),d3.time.minutes(Math.min(start,stop),Math.max(start,stop))},getHourDomain:function(d,range){var start=new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours()),stop=null;range instanceof Date?stop=new Date(range.getFullYear(),range.getMonth(),range.getDate(),range.getHours()):(stop=new Date(start)).setHours(stop.getHours()+range);var domains=d3.time.hours(Math.min(start,stop),Math.max(start,stop)),i=0,total=domains.length;for(i=0;i<total;i++)if(0<i&&domains[i].getHours()===domains[i-1].getHours()){this.DSTDomain.push(domains[i].getTime()),domains.splice(i,1);break}return"number"==typeof range&&domains.length>Math.abs(range)&&domains.splice(domains.length-1,1),domains},getDayDomain:function(d,range){var start=new Date(d.getFullYear(),d.getMonth(),d.getDate()),stop=null;return range instanceof Date?stop=new Date(range.getFullYear(),range.getMonth(),range.getDate()):(stop=new Date(start),stop=new Date(stop.setDate(stop.getDate()+parseInt(range,10)))),d3.time.days(Math.min(start,stop),Math.max(start,stop))},getWeekDomain:function(d,range){var weekStart;!1===this.options.weekStartOnMonday?weekStart=new Date(d.getFullYear(),d.getMonth(),d.getDate()-d.getDay()):1===d.getDay()?weekStart=new Date(d.getFullYear(),d.getMonth(),d.getDate()):0===d.getDay()?(weekStart=new Date(d.getFullYear(),d.getMonth(),d.getDate())).setDate(weekStart.getDate()-6):weekStart=new Date(d.getFullYear(),d.getMonth(),d.getDate()-d.getDay()+1);var endDate=new Date(weekStart),stop=range;return"object"!==_typeof(range)&&(stop=new Date(endDate.setDate(endDate.getDate()+7*range))),!0===this.options.weekStartOnMonday?d3.time.mondays(Math.min(weekStart,stop),Math.max(weekStart,stop)):d3.time.sundays(Math.min(weekStart,stop),Math.max(weekStart,stop))},getMonthDomain:function(d,range){var start=new Date(d.getFullYear(),d.getMonth()),stop=null;return range instanceof Date?stop=new Date(range.getFullYear(),range.getMonth()):stop=(stop=new Date(start)).setMonth(stop.getMonth()+range),d3.time.months(Math.min(start,stop),Math.max(start,stop))},getYearDomain:function(d,range){var stop,start=new Date(d.getFullYear(),0);return stop=range instanceof Date?new Date(range.getFullYear(),0):new Date(d.getFullYear()+range,0),d3.time.years(Math.min(start,stop),Math.max(start,stop))},getDomain:function(date,range){switch("number"==typeof date&&(date=new Date(date)),2>arguments.length&&(range=this.options.range),this.options.domain){case"hour":var domains=this.getHourDomain(date,range);return"number"==typeof range&&domains.length<range&&(0<range?domains.push(this.getHourDomain(domains[domains.length-1],2)[1]):domains.shift(this.getHourDomain(domains[0],-2)[0])),domains;case"day":return this.getDayDomain(date,range);case"week":return this.getWeekDomain(date,range);case"month":return this.getMonthDomain(date,range);case"year":return this.getYearDomain(date,range)}},getSubDomain:function(date){"number"==typeof date&&(date=new Date(date));var domain,parent=this;switch(this.options.subDomain){case"x_min":case"min":return this.getMinuteDomain(date,"hour"===(domain=this.options.domain)?60:"day"===domain?1440:"week"===domain?10080:void 0);case"x_hour":case"hour":return this.getHourDomain(date,function(date,domain){return"day"===domain?24:"week"===domain?168:"month"===domain?24*parent.getDayCountInMonth(date):void 0}(date,this.options.domain));case"x_day":case"day":return this.getDayDomain(date,function(date,domain){return"year"===domain?parent.getDayCountInYear(date):"month"===domain?parent.getDayCountInMonth(date):"week"===domain?7:void 0}(date,this.options.domain));case"x_week":case"week":return this.getWeekDomain(date,function(date,domain){if("month"===domain){var endOfMonth=new Date(date.getFullYear(),date.getMonth()+1,0),endWeekNb=parent.getWeekNumber(endOfMonth),startWeekNb=parent.getWeekNumber(new Date(date.getFullYear(),date.getMonth()));return startWeekNb>endWeekNb&&(startWeekNb=0,endWeekNb++),endWeekNb-startWeekNb+1}return"year"===domain?parent.getWeekNumber(new Date(date.getFullYear(),11,31)):void 0}(date,this.options.domain));case"x_month":case"month":return this.getMonthDomain(date,12)}},getNextDomain:function(n){return 0===arguments.length&&(n=1),this.getDomain(this.jumpDate(this.getDomainKeys().pop(),n,this.options.domain),1)[0]},getPreviousDomain:function(n){return 0===arguments.length&&(n=1),this.getDomain(this.jumpDate(this.getDomainKeys().shift(),-n,this.options.domain),1)[0]},getDatas:function(source,startDate,endDate,callback,afterLoad,updateMode){var self=this;5>arguments.length&&(afterLoad=!0),6>arguments.length&&(updateMode=this.APPEND_ON_UPDATE);var _callback=function(error,data){!1===afterLoad?("csv"===self.options.dataType||"tsv"===self.options.dataType)&&(data=this.interpretCSV(data)):"function"==typeof afterLoad?data=afterLoad(data):"function"==typeof self.options.afterLoadData?data=self.options.afterLoadData(data):console.log("Provided callback for afterLoadData is not a function."),self.parseDatas(data,updateMode,startDate,endDate),"function"==typeof callback&&callback()};switch(_typeof(source)){case"string":if(""===source)return _callback(0,{}),!0;var url=this.parseURI(source,startDate,endDate),requestType="GET";null!==self.options.dataPostPayload&&(requestType="POST");var payload=null;null!==self.options.dataPostPayload&&(payload=this.parseURI(self.options.dataPostPayload,startDate,endDate));var xhr=null;switch(this.options.dataType){case"json":xhr=d3.json(url);break;case"csv":xhr=d3.csv(url);break;case"tsv":xhr=d3.tsv(url);break;case"txt":xhr=d3.text(url,"text/plain")}if(null!==self.options.dataRequestHeaders)for(var header in self.options.dataRequestHeaders)self.options.dataRequestHeaders.hasOwnProperty(header)&&xhr.header(header,self.options.dataRequestHeaders[header]);return xhr.send(requestType,payload,_callback),!1;case"object":if(source===Object(source))return _callback(0,source),!1;default:return _callback(0,{}),!0}},parseDatas:function(data,updateMode,startDate,endDate){updateMode===this.RESET_ALL_ON_UPDATE&&this._domains.forEach(function(key,value){value.forEach(function(element,index,array){array[index].v=null})});var temp={},extractTime=function(d){return d.t};for(var d in data){var date=new Date(1e3*d),domainUnit=this.getDomain(date)[0].getTime();if(0<=this.DSTDomain.indexOf(domainUnit)&&this._domains.has(domainUnit-36e5)&&(domainUnit-=36e5),!isNaN(d)&&data.hasOwnProperty(d)&&this._domains.has(domainUnit)&&domainUnit>=+startDate&&domainUnit<+endDate){var subDomainsData=this._domains.get(domainUnit);temp.hasOwnProperty(domainUnit)||(temp[domainUnit]=subDomainsData.map(extractTime));var index=temp[domainUnit].indexOf(this._domainType[this.options.subDomain].extractUnit(date));updateMode===this.RESET_SINGLE_ON_UPDATE?subDomainsData[index].v=data[d]:isNaN(subDomainsData[index].v)?subDomainsData[index].v=data[d]:subDomainsData[index].v+=data[d]}}},parseURI:function(str,startDate,endDate){return str=(str=(str=(str=str.replace(/\{\{t:start\}\}/g,startDate.getTime()/1e3)).replace(/\{\{t:end\}\}/g,endDate.getTime()/1e3)).replace(/\{\{d:start\}\}/g,startDate.toISOString())).replace(/\{\{d:end\}\}/g,endDate.toISOString())},interpretCSV:function(data){var i,total,d={},keys=Object.keys(data[0]);for(i=0,total=data.length;i<total;i++)d[data[i][keys[0]]]=+data[i][keys[1]];return d},resize:function(){var options=this.options,legendWidth=options.displayLegend?this.Legend.getDim("width")+options.legendMargin[1]+options.legendMargin[3]:0,legendHeight=options.displayLegend?this.Legend.getDim("height")+options.legendMargin[0]+options.legendMargin[2]:0,graphWidth=this.graphDim.width-options.domainGutter-options.cellPadding,graphHeight=this.graphDim.height-options.domainGutter-options.cellPadding;this.root.transition().duration(options.animationDuration).attr("width",function(){return"middle"===options.legendVerticalPosition||"center"===options.legendVerticalPosition?graphWidth+legendWidth:Math.max(graphWidth,legendWidth)}).attr("height",function(){return"middle"===options.legendVerticalPosition||"center"===options.legendVerticalPosition?Math.max(graphHeight,legendHeight):graphHeight+legendHeight}),this.root.select(".graph").transition().duration(options.animationDuration).attr("y",function(){return"top"===options.legendVerticalPosition?legendHeight:0}).attr("x",function(){return"middle"!==options.legendVerticalPosition&&"center"!==options.legendVerticalPosition||"left"!==options.legendHorizontalPosition?0:legendWidth})},next:function(n){return 0===arguments.length&&(n=1),this.loadNextDomain(n)},previous:function(n){return 0===arguments.length&&(n=1),this.loadPreviousDomain(n)},jumpTo:function(date,reset){2>arguments.length&&(reset=!1);var domains=this.getDomainKeys(),firstDomain=domains[0],lastDomain=domains[domains.length-1];return date<firstDomain?this.loadPreviousDomain(this.getDomain(firstDomain,date).length):reset?this.loadNextDomain(this.getDomain(firstDomain,date).length):!!(date>lastDomain)&&this.loadNextDomain(this.getDomain(lastDomain,date).length)},rewind:function(){this.jumpTo(this.options.start,!0)},update:function(dataSource,afterLoad,updateMode){0===arguments.length&&(dataSource=this.options.data),2>arguments.length&&(afterLoad=!0),3>arguments.length&&(updateMode=this.RESET_ALL_ON_UPDATE);var domains=this.getDomainKeys(),self=this;this.getDatas(dataSource,new Date(domains[0]),this.getSubDomain(domains[domains.length-1]).pop(),function(){self.fill(),self.afterUpdate()},afterLoad,updateMode)},setLegend:function(){var oldLegend=this.options.legend.slice(0);1<=arguments.length&&Array.isArray(arguments[0])&&(this.options.legend=arguments[0]),2<=arguments.length&&(Array.isArray(arguments[1])&&2<=arguments[1].length?this.options.legendColors=[arguments[1][0],arguments[1][1]]:this.options.legendColors=arguments[1]),(0<arguments.length&&!function arrayEquals(arrayA,arrayB){if(!arrayB||!arrayA)return!1;if(arrayA.length!==arrayB.length)return!1;for(var i=0;i<arrayA.length;i++)if(arrayA[i]instanceof Array&&arrayB[i]instanceof Array){if(!arrayEquals(arrayA[i],arrayB[i]))return!1}else if(arrayA[i]!==arrayB[i])return!1;return!0}(oldLegend,this.options.legend)||2<=arguments.length)&&(this.Legend.buildColors(),this.fill()),this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding)},removeLegend:function(){return!!this.options.displayLegend&&(this.options.displayLegend=!1,this.Legend.remove(),!0)},showLegend:function(){return!this.options.displayLegend&&(this.options.displayLegend=!0,this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding),!0)},highlight:function(args){return!!(0<(this.options.highlight=this.expandDateSetting(args)).length)&&(this.fill(),!0)},destroy:function(callback){return this.root.transition().duration(this.options.animationDuration).attr("width",0).attr("height",0).remove().each("end",function(){"function"==typeof callback?callback():void 0!==callback&&console.log("Provided callback for destroy() is not a function.")}),null},getSVG:function(){for(var styles={".cal-heatmap-container":{},".graph":{},".graph-rect":{},"rect.highlight":{},"rect.now":{},"rect.highlight-now":{},"text.highlight":{},"text.now":{},"text.highlight-now":{},".domain-background":{},".graph-label":{},".subdomain-text":{},".q0":{},".qi":{}},j=1,total=this.options.legend.length+1;j<=total;j++)styles[".q"+j]={};var e,root=this.root,whitelistStyles=["stroke","stroke-width","stroke-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-miterlimit","fill","fill-opacity","fill-rule","marker","marker-start","marker-mid","marker-end","alignement-baseline","baseline-shift","dominant-baseline","glyph-orientation-horizontal","glyph-orientation-vertical","kerning","text-anchor","shape-rendering","text-transform","font-family","font","font-size","font-weight"],filterStyles=function(attribute,property,value){-1!==whitelistStyles.indexOf(property)&&(styles[attribute][property]=value)};for(var element in styles)if(styles.hasOwnProperty(element)){var dom=(e=element,root.select(e)[0][0]);if(null!==dom)if("getComputedStyle"in window){var cs=getComputedStyle(dom,null);if(0!==cs.length)for(var i=0;i<cs.length;i++)filterStyles(element,cs.item(i),cs.getPropertyValue(cs.item(i)));else for(var k in cs)cs.hasOwnProperty(k)&&filterStyles(element,k,cs[k])}else if("currentStyle"in dom){var css=dom.currentStyle;for(var p in css)filterStyles(element,p,css[p])}}var string='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style type="text/css"><![CDATA[ ';for(var style in styles){for(var l in string+=style+" {\n",styles[style])string+="\t"+l+":"+styles[style][l]+";\n";string+="}\n"}return string+="]]></style>",string+=(new XMLSerializer).serializeToString(this.root[0][0]),string+="</svg>"}};var DomainPosition=function(){this.positions=d3.map()};DomainPosition.prototype.getPosition=function(d){return this.positions.get(d)},DomainPosition.prototype.getPositionFromIndex=function(i){var domains=this.getKeys();return this.positions.get(domains[i])},DomainPosition.prototype.getLast=function(){var domains=this.getKeys();return this.positions.get(domains[domains.length-1])},DomainPosition.prototype.setPosition=function(d,dim){this.positions.set(d,dim)},DomainPosition.prototype.shiftRightBy=function(exitingDomainDim){this.positions.forEach(function(key,value){this.set(key,value-exitingDomainDim)});var domains=this.getKeys();this.positions.remove(domains[0])},DomainPosition.prototype.shiftLeftBy=function(enteringDomainDim){this.positions.forEach(function(key,value){this.set(key,value+enteringDomainDim)});var domains=this.getKeys();this.positions.remove(domains[domains.length-1])},DomainPosition.prototype.getKeys=function(){return this.positions.keys().sort(function(a,b){return parseInt(a,10)-parseInt(b,10)})};var Legend=function(calendar){this.calendar=calendar,this.computeDim(),null!==calendar.options.legendColors&&this.buildColors()};Legend.prototype.computeDim=function(){var options=this.calendar.options;this.dim={width:options.legendCellSize*(options.legend.length+1)+options.legendCellPadding*options.legend.length,height:options.legendCellSize}},Legend.prototype.remove=function(){this.calendar.root.select(".graph-legend").remove(),this.calendar.resize()},Legend.prototype.redraw=function(width){function legendCellLayout(selection){selection.attr("width",options.legendCellSize).attr("height",options.legendCellSize).attr("rx",options.legendCellRadius).attr("ry",options.legendCellRadius).attr("x",function(d,i){return i*(options.legendCellSize+options.legendCellPadding)})}function getLegendXPosition(){switch(options.legendHorizontalPosition){case"right":return"center"===options.legendVerticalPosition||"middle"===options.legendVerticalPosition?width+options.legendMargin[3]:width-parent.getDim("width")-options.legendMargin[1];case"middle":case"center":return Math.round(width/2-parent.getDim("width")/2);default:return options.legendMargin[3]}}function getLegendYPosition(){return"bottom"===options.legendVerticalPosition?calendar.graphDim.height+options.legendMargin[0]-options.domainGutter-options.cellPadding:options.legendMargin[0]}if(!this.calendar.options.displayLegend)return!1;var legendItem,parent=this,calendar=this.calendar,legend=calendar.root,options=calendar.options;this.computeDim();var _legend=options.legend.slice(0);_legend.push(_legend[_legend.length-1]+1);var legendElement=calendar.root.select(".graph-legend");null===legendElement[0][0]?((legend="top"===options.legendVerticalPosition?legend.insert("svg",".graph"):legend.append("svg")).attr("x",getLegendXPosition()).attr("y",getLegendYPosition()),legendItem=legend.attr("class","graph-legend").attr("height",parent.getDim("height")).attr("width",parent.getDim("width")).append("g").selectAll().data(_legend)):legendItem=(legend=legendElement).select("g").selectAll("rect").data(_legend),legendItem.enter().append("rect").call(legendCellLayout).attr("class",function(d){return calendar.Legend.getClass(d,null===calendar.legendScale)}).attr("fill-opacity",0).call(function(selection){null!==calendar.legendScale&&null!==options.legendColors&&options.legendColors.hasOwnProperty("base")&&selection.attr("fill",options.legendColors.base)}).append("title"),legendItem.exit().transition().duration(options.animationDuration).attr("fill-opacity",0).remove(),legendItem.transition().delay(function(d,i){return options.animationDuration*i/10}).call(legendCellLayout).attr("fill-opacity",1).call(function(element){element.attr("fill",function(d,i){return null===calendar.legendScale?"":0===i?calendar.legendScale(d-1):calendar.legendScale(options.legend[i-1])}),element.attr("class",function(d){return calendar.Legend.getClass(d,null===calendar.legendScale)})}),legendItem.select("title").text(function(d,i){return 0===i?calendar.formatStringWithObject(options.legendTitleFormat.lower,{min:options.legend[i],name:options.itemName[1]}):i===_legend.length-1?calendar.formatStringWithObject(options.legendTitleFormat.upper,{max:options.legend[i-1],name:options.itemName[1]}):calendar.formatStringWithObject(options.legendTitleFormat.inner,{down:options.legend[i-1],up:options.legend[i],name:options.itemName[1]})}),legendItem.on("mouseover",function(d){calendar.legendTip.show(d,this)}).on("mouseout",function(){calendar.legendTip.hide()}),legend.transition().duration(options.animationDuration).attr("x",getLegendXPosition()).attr("y",getLegendYPosition()).attr("width",parent.getDim("width")).attr("height",parent.getDim("height")),legend.select("g").transition().duration(options.animationDuration).attr("transform",function(){return"vertical"===options.legendOrientation?"rotate(90 "+options.legendCellSize/2+" "+options.legendCellSize/2+")":""}),calendar.resize()},Legend.prototype.getDim=function(axis){var isHorizontal="horizontal"===this.calendar.options.legendOrientation;return"width"===axis?this.dim[isHorizontal?"width":"height"]:"height"===axis?this.dim[isHorizontal?"height":"width"]:void 0},Legend.prototype.buildColors=function(){var options=this.calendar.options;if(null===options.legendColors)return this.calendar.legendScale=null,!1;var _colorRange=[];if(Array.isArray(options.legendColors))_colorRange=options.legendColors;else{if(!options.legendColors.hasOwnProperty("min")||!options.legendColors.hasOwnProperty("max"))return options.legendColors=null,!1;_colorRange=[options.legendColors.min,options.legendColors.max]}var _legend=options.legend.slice(0);0<_legend[0]?_legend.unshift(0):0>=_legend[0]&&_legend.unshift(_legend[0]-(_legend[_legend.length-1]-_legend[0])/_legend.length);var colorScale=options.legendColors.hasOwnProperty("colorScale")?options.legendColors.colorScale:d3.scale.linear().range(_colorRange).interpolate(d3.interpolateHcl).domain([d3.min(_legend),d3.max(_legend)]),legendColors=_legend.map(function(element){return colorScale(element)});return this.calendar.legendScale=d3.scale.threshold().domain(options.legend).range(legendColors),!0},Legend.prototype.getClass=function(n,withCssClass){if(null===n||isNaN(n))return"";for(var index=[this.calendar.options.legend.length+1],i=0,total=this.calendar.options.legend.length-1;i<=total;i++){if(0<this.calendar.options.legend[0]&&0>n){index=["1","i"];break}if(n<=this.calendar.options.legend[i]){index=[i+1];break}}return 0===n&&index.push(0),index.unshift(""),(index.join(" r")+(withCssClass?index.join(" q"):"")).trim()};var cal_heatmap=CalHeatMap;var convertUTCTS=function(uts){return(dttm=new Date(uts),new Date(dttm.getUTCFullYear(),dttm.getUTCMonth(),dttm.getUTCDate(),dttm.getUTCHours(),dttm.getUTCMinutes(),dttm.getUTCSeconds())).getTime();var dttm},propTypes={data:prop_types_default.a.shape({data:prop_types_default.a.object,domain:prop_types_default.a.string,range:prop_types_default.a.number,start:prop_types_default.a.number,subdomain:prop_types_default.a.string}),height:prop_types_default.a.number,cellPadding:prop_types_default.a.number,cellRadius:prop_types_default.a.number,cellSize:prop_types_default.a.number,linearColorScheme:prop_types_default.a.string,showLegend:prop_types_default.a.bool,showMetricName:prop_types_default.a.bool,showValues:prop_types_default.a.bool,steps:prop_types_default.a.number,timeFormat:prop_types_default.a.string,valueFormat:prop_types_default.a.string,verboseMap:prop_types_default.a.object};function Calendar(element,props){var data=props.data,height=props.height,_props$cellPadding=props.cellPadding,cellPadding=void 0===_props$cellPadding?3:_props$cellPadding,_props$cellRadius=props.cellRadius,cellRadius=void 0===_props$cellRadius?0:_props$cellRadius,_props$cellSize=props.cellSize,cellSize=void 0===_props$cellSize?10:_props$cellSize,linearColorScheme=props.linearColorScheme,showLegend=props.showLegend,showMetricName=props.showMetricName,showValues=props.showValues,steps=props.steps,timeFormat=props.timeFormat,valueFormat=props.valueFormat,verboseMap=props.verboseMap,valueFormatter=Object(number_format_lib.getNumberFormatter)(valueFormat),timeFormatter=Object(time_format_lib.getTimeFormatter)(timeFormat),container=Object(d3_selection.select)(element).classed("superset-legacy-chart-calendar",!0).style("height",height);container.selectAll("*").remove();var div=container.append("div"),subDomainTextFormat=showValues?function(date,value){return valueFormatter(value)}:null,metricsData={};Object.keys(data.data).forEach(function(metric){metricsData[metric]={},Object.keys(data.data[metric]).forEach(function(ts){metricsData[metric][convertUTCTS(1e3*ts)/1e3]=data.data[metric][ts]})}),Object.keys(metricsData).forEach(function(metric){var calContainer=div.append("div");showMetricName&&calContainer.text("Metric: ".concat(verboseMap[metric]||metric));var timestamps=metricsData[metric],extents=Object(d3_array.extent)(Object.keys(timestamps),function(key){return timestamps[key]}),step=(extents[1]-extents[0])/(steps-1),colorScale=Object(color_lib.getSequentialSchemeRegistry)().get(linearColorScheme).createLinearScale(extents),legend=Object(d3_array.range)(steps).map(function(i){return extents[0]+step*i}),legendColors=legend.map(colorScale);(new cal_heatmap).init({start:convertUTCTS(data.start),data:timestamps,itemSelector:calContainer.node(),legendVerticalPosition:"top",cellSize:cellSize,cellPadding:cellPadding,cellRadius:cellRadius,legendCellSize:cellSize,legendCellPadding:2,legendCellRadius:cellRadius,tooltip:!0,domain:data.domain,subDomain:data.subdomain,range:data.range,browsing:!0,legend:legend,legendColors:{colorScale:colorScale,min:legendColors[0],max:legendColors[legendColors.length-1],empty:"white"},displayLegend:showLegend,itemName:"",valueFormatter:valueFormatter,timeFormatter:timeFormatter,subDomainTextFormat:subDomainTextFormat})})}Calendar.displayName="Calendar",Calendar.propTypes=propTypes;var src_Calendar=Calendar;__webpack_exports__.default=Object(lib.reactify)(src_Calendar)}}]);
//# sourceMappingURL=14.a2ec2c33ba01cd68b610.bundle.js.map
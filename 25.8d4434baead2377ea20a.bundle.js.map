{"version":3,"file":"25.8d4434baead2377ea20a.bundle.js","sources":["webpack:///../superset-ui-legacy-plugin-chart-paired-t-test/lib/TTestTable.js"],"sourcesContent":["\"use strict\";exports.__esModule=!0,exports.default=exports.dataPropType=void 0;var _distributions=_interopRequireDefault(require(\"distributions\")),_react=_interopRequireDefault(require(\"react\")),_reactableArc=require(\"reactable-arc\"),_propTypes=_interopRequireDefault(require(\"prop-types\"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _inheritsLoose(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.__proto__=b}var dataPropType=_propTypes.default.arrayOf(_propTypes.default.shape({group:_propTypes.default.arrayOf(_propTypes.default.string),values:_propTypes.default.arrayOf(_propTypes.default.shape({x:_propTypes.default.number,y:_propTypes.default.number}))}));exports.dataPropType=dataPropType;var propTypes={alpha:_propTypes.default.number,data:dataPropType.isRequired,groups:_propTypes.default.arrayOf(_propTypes.default.string).isRequired,liftValPrec:_propTypes.default.number,metric:_propTypes.default.string.isRequired,pValPrec:_propTypes.default.number},defaultProps={alpha:.05,liftValPrec:4,pValPrec:6},TTestTable=/*#__PURE__*/function(a){var c=Number.isFinite,d=Number.isNaN;function b(b){var c;return c=a.call(this,b)||this,c.state={control:0,liftValues:[],pValues:[]},c}_inheritsLoose(b,a);var e=b.prototype;return e.componentWillMount=function b(){var a=this.state.control;this.computeTTest(a)},e.getLiftStatus=function h(a){var b=this.state,e=b.control,f=b.liftValues;// Get a css class name for coloring\nif(a===e)return\"control\";var g=f[a];return d(g)||!c(g)?\"invalid\":0<=g?\"true\":\"false\";// green on true, red on false\n},e.getPValueStatus=function h(a){var b=this.state,e=b.control,f=b.pValues;if(a===e)return\"control\";var g=f[a];return d(g)||!c(g)?\"invalid\":\"\";// p-values won't normally be colored\n},e.getSignificance=function f(a){var b=this.state,c=b.control,d=b.pValues,e=this.props.alpha;// Color significant as green, else red\nreturn a===c?\"control\":d[a]<=e;// p-values significant below set threshold\n},e.computeLift=function g(a,b){for(var c=this.props.liftValPrec,d=0,e=0,f=0;f<a.length;f++)d+=a[f].y,e+=b[f].y;return(100*((d-e)/e)).toFixed(c)},e.computePValue=function m(a,b){for(var c=Math.abs,d=Math.sqrt,e,f=this.props.pValPrec,g=0,h=0,j=0,k=0;k<a.length;k++)e=b[k].y-a[k].y,isFinite(e)&&(j++,g+=e,h+=e*e);var l=-c(g*d((j-1)/(j*h-g*g)));try{return(2*new _distributions.default.Studentt(j-1).cdf(l)).toFixed(f);// two-sided test\n}catch(a){return NaN}},e.computeTTest=function e(a){// Compute lift and p-values for each row\n// against the selected control\nvar b=this.props.data,c=[],d=[];if(b){for(var f=0;f<b.length;f++)f===a?(c.push(\"control\"),d.push(\"control\")):(c.push(this.computePValue(b[f].values,b[a].values)),d.push(this.computeLift(b[f].values,b[a].values)));this.setState({control:a,liftValues:d,pValues:c})}},e.render=function o(){var a=this,b=this.props,c=b.data,d=b.metric,e=b.groups,f=this.state,g=f.control,h=f.liftValues,j=f.pValues,k=e.map(function(a,b){return _react.default.createElement(_reactableArc.Th,{key:b,column:a},a)}),l=e.length;k.push(_react.default.createElement(_reactableArc.Th,{key:l+1,column:\"pValue\"},\"p-value\")),k.push(_react.default.createElement(_reactableArc.Th,{key:l+2,column:\"liftValue\"},\"Lift %\")),k.push(_react.default.createElement(_reactableArc.Th,{key:l+3,column:\"significant\"},\"Significant\"));var m=c.map(function(b,c){var d=e.map(function(a,c){return(// group names\n_react.default.createElement(_reactableArc.Td,{key:c,column:a,data:b.group[c]}))});return d.push(_react.default.createElement(_reactableArc.Td,{key:l+1,className:a.getPValueStatus(c),column:\"pValue\",data:j[c]})),d.push(_react.default.createElement(_reactableArc.Td,{key:l+2,className:a.getLiftStatus(c),column:\"liftValue\",data:h[c]})),d.push(_react.default.createElement(_reactableArc.Td,{key:l+3,className:a.getSignificance(c),column:\"significant\",data:a.getSignificance(c)})),_react.default.createElement(_reactableArc.Tr,{key:c,onClick:a.computeTTest.bind(a,c),className:c===g?\"control\":\"\"},d)}),n=e.concat([{column:\"pValue\",sortFunction:function b(c,a){return\"control\"===c?-1:\"control\"===a?1:c>a?1:-1;// p-values ascending\n}},{column:\"liftValue\",sortFunction:function b(c,a){return\"control\"===c?-1:\"control\"===a?1:parseFloat(c)>parseFloat(a)?-1:1;// lift values descending\n}},{column:\"significant\",sortFunction:function b(c,a){return\"control\"===c?-1:\"control\"===a?1:c>a?-1:1;// significant values first\n}}]);// When sorted ascending, 'control' will always be at top\nreturn _react.default.createElement(\"div\",null,_react.default.createElement(\"h3\",null,d),_react.default.createElement(_reactableArc.Table,{className:\"table\",id:\"table_\"+d,sortable:n},_react.default.createElement(_reactableArc.Thead,null,k),m))},b}(_react.default.Component);TTestTable.propTypes=propTypes,TTestTable.defaultProps=defaultProps;var _default=TTestTable;exports.default=_default;"],"mappings":"AAAA","sourceRoot":""}
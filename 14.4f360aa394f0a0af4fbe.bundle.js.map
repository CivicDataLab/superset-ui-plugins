{"version":3,"file":"14.4f360aa394f0a0af4fbe.bundle.js","sources":["webpack:///../superset-ui-legacy-plugin-chart-sankey/lib/Sankey.js"],"sourcesContent":["\"use strict\";exports.__esModule=!0,exports.default=void 0;var _d=_interopRequireDefault(require(\"d3\")),_propTypes=_interopRequireDefault(require(\"prop-types\")),_d3Sankey=require(\"d3-sankey\"),_color=require(\"@superset-ui/color\"),_numberFormat=require(\"@superset-ui/number-format\");require(\"./Sankey.css\");function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */ /* eslint-disable no-param-reassign, no-magic-numbers, sort-keys, babel/no-invalid-this */var propTypes={data:_propTypes.default.arrayOf(_propTypes.default.shape({source:_propTypes.default.string,target:_propTypes.default.string,value:_propTypes.default.number})),width:_propTypes.default.number,height:_propTypes.default.number,colorScheme:_propTypes.default.string},formatNumber=(0,_numberFormat.getNumberFormatter)(_numberFormat.NumberFormats.FLOAT);function Sankey(a,b){var f=Math.max;function c(a){var c,b=Number.isFinite;if(a.sourceLinks)// is node\nc=a.name+\" Value: <span class='emph'>\"+formatNumber(a.value)+\"</span>\";else{var d=formatNumber(a.value),e=_d.default.round(100*(a.value/a.source.value),1),f=_d.default.round(100*(a.value/a.target.value),1);c=[\"<div class=''>Path Value: <span class='emph'>\",d,\"</span></div>\",\"<div class='percents'>\",\"<span class='emph'>\",b(e)?e:\"100\",\"%</span> of \",a.source.name,\"<br/>\",\"<span class='emph'>\"+(b(f)?f:\"--\")+\"%</span> of \",a.target.name,\"target\",\"</div>\"].join(\"\")}return c}function d(a){p.html(function(){return c(a)}).transition().duration(200).style(\"left\",_d.default.event.offsetX+10+\"px\").style(\"top\",_d.default.event.offsetY+10+\"px\").style(\"opacity\",.95)}function e(){p.transition().duration(100).style(\"opacity\",0)}var g=b.data,h=b.width,i=b.height,j=b.colorScheme,k=_d.default.select(a);k.classed(\"superset-legacy-chart-sankey\",!0);var l={top:5,right:5,bottom:5,left:5},m=h-l.left-l.right,n=i-l.top-l.bottom;k.selectAll(\"*\").remove();var o=k.append(\"svg\").attr(\"width\",m+l.left+l.right).attr(\"height\",n+l.top+l.bottom).append(\"g\").attr(\"transform\",\"translate(\"+l.left+\",\"+l.top+\")\"),p=k.append(\"div\").attr(\"class\",\"sankey-tooltip\").style(\"opacity\",0),q=_color.CategoricalColorNamespace.getScale(j),r=(0,_d3Sankey.sankey)().nodeWidth(15).nodePadding(10).size([m,n]),s=r.link(),t={},u=g.map(function(a){var b=Object.assign({},a);return b.source=t[b.source]||(t[b.source]={name:b.source}),b.target=t[b.target]||(t[b.target]={name:b.target}),b.value=+b.value,b});t=_d.default.values(t),r.nodes(t).links(u).layout(32);var v=o.append(\"g\").selectAll(\".link\").data(u).enter().append(\"path\").attr(\"class\",\"link\").attr(\"d\",s).style(\"stroke-width\",function(a){return f(1,a.dy)}).sort(function(c,a){return a.dy-c.dy}).on(\"mouseover\",d).on(\"mouseout\",e),w=o.append(\"g\").selectAll(\".node\").data(t).enter().append(\"g\").attr(\"class\",\"node\").attr(\"transform\",function(a){return\"translate(\"+a.x+\",\"+a.y+\")\"}).call(_d.default.behavior.drag().origin(function(a){return a}).on(\"dragstart\",function(){this.parentNode.appendChild(this)}).on(\"drag\",function(a){_d.default.select(this).attr(\"transform\",\"translate(\"+a.x+\",\"+(a.y=f(0,Math.min(i-a.dy,_d.default.event.y)))+\")\"),r.relayout(),v.attr(\"d\",s)})),x=5;w.append(\"rect\").attr(\"height\",function(a){return a.dy>x?a.dy:x}).attr(\"width\",r.nodeWidth()).style(\"fill\",function(a){var b=a.name||\"N/A\";return a.color=q(b.replace(/ .*/,\"\")),a.color}).style(\"stroke\",function(a){return _d.default.rgb(a.color).darker(2)}).on(\"mouseover\",d).on(\"mouseout\",e),w.append(\"text\").attr(\"x\",-6).attr(\"y\",function(a){return a.dy/2}).attr(\"dy\",\".35em\").attr(\"text-anchor\",\"end\").attr(\"transform\",null).text(function(a){return a.name}).filter(function(a){return a.x<m/2}).attr(\"x\",6+r.nodeWidth()).attr(\"text-anchor\",\"start\")}Sankey.displayName=\"Sankey\",Sankey.propTypes=propTypes;var _default=Sankey;exports.default=_default;"],"mappings":"AAAA","sourceRoot":""}